// Generated by CoffeeScript 1.4.0
(function() {

  (function($) {
    var $search_bar, $search_buttons, labs, lectures, sections, students;
    $search_buttons = $('.search_buttons');
    $search_bar = $('.search-bar');
    $.fn.typeahead.Constructor.prototype.blur = function() {
      var that;
      that = this;
      return setTimeout((function() {
        return that.hide();
      }), 250);
    };
    students = {};
    lectures = {};
    sections = {};
    labs = {};
    return $search_buttons.on('click', function(e) {
      if ($(this).text() === 'User') {
        $('.search_class.active').button('toggle');
        $('.search-bar').typeahead({
          source: function(query, process) {
            return $.getJSON('/search/student', function(data) {
              var results;
              console.log(data);
              students = data;
              results = _.map(data, function(student) {
                return "" + student.name;
              });
              console.log(results);
              console.log(students);
              process(results);
            });
          },
          highlighter: function(name) {
            return "" + name;
          },
          updater: function(name) {
            var student;
            student = _.where(students, {
              name: name
            });
            location.href = "/student/" + student[0].id;
            return name;
          }
        });
        return;
      } else {
        $('#user-search.active').button('toggle');
        if ($(this).text() === 'Lecture') {
          $('.search-bar').typeahead({
            source: function(query, process) {
              return $.getJSON("/search/lecture?q=" + query, function(data) {
                var departments, names, results, titles;
                console.log(data);
                lectures = data;
                titles = _.map(data, function(lecture) {
                  return "" + lecture.title;
                });
                names = _.map(data, function(lecture) {
                  return "" + lecture.name;
                });
                departments = _.map(data, function(lecture) {
                  return "" + lecture.department;
                });
                results = titles.concat(names, departments);
                console.log(results);
                return process(results);
              });
            },
            highlighter: function(text) {
              var lecture;
              lecture = _.where(lectures, {
                title: text
              });
              lecture = lecture.concat(_.where(lectures, {
                department: text
              }));
              lecture = lecture.conact(_.where(lectures, {
                name: text
              }));
              return "" + lecture[0].name;
            },
            updater: function(text) {
              var lecture;
              lecture = _.where(lectures, {
                title: text
              });
              return "" + text;
            }
          });
        }
      }
    });
  })(jQuery);

}).call(this);
